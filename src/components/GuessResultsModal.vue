<script setup lang="ts">
import { VueFinalModal } from 'vue-final-modal'
import { GoogleMap } from 'vue3-google-map';
import { type Ref } from 'vue';
import { type Image } from '@/models/image';
import { type Guess } from '@/models/guess';

const props = defineProps<{
    image?: Ref<Image | undefined>,
    guess?: Ref<Guess | undefined>
}>()

const imageValue = props.image;
const guessValue = props.guess;

const emit = defineEmits<{
    (e: 'confirm'): void,
    (e: 'closed'): void
}>()
</script>

<template>
    <VueFinalModal
        class="guess-results-modal"
        content-class="guess-results-modal__content"
        overlay-transition="vfm-fade"
        content-transition="vfm-fade"
        :click-to-close="false"
        :esc-to-close="false"
        v-on:opened="console.log('test')"
        v-on:closed="emit('closed')">
        <div class="guess-results-modal__timer guess-results-modal__game-control">{{ guessValue?.time }}</div>
        <div class="guess-results-modal__stage guess-results-modal__game-control">{{ guessValue?.stage }}</div>
        <main class="guess-results-modal__content--main">
            <h1>{{ imageValue?.title }}</h1>
            <GoogleMap class="guess-results-modal__content--map" api-key="AIzaSyCcQMDjEPrA9cCZAHQfPW1n47H4r5Bx4EI" :zoom="15"></GoogleMap>
            <h2>
                Your guess was 
                <span :class="guessValue?.correct ? 'guess-results-modal__correct' : 'guess-results-modal__incorrect'">{{ guessValue?.correct ? 'CORRECT' : 'INCORRECT' }}</span>!
                Your guess was <span :class="guessValue?.correct ? 'guess-results-modal__correct' : 'guess-results-modal__incorrect'">{{ guessValue?.distance }}m</span> away from the correct location.
            </h2>
            <p>{{ imageValue?.description }}</p>
        </main>
        <button class="guess-results-modal__next" @click="emit('confirm')">NEXT ROUND</button>
    </VueFinalModal>
</template>

<style>
/*
 * vue-final-modal forces us to use global css so namespacing these classes
 */

.guess-results-modal {
    display: grid;
    grid-template-columns: 1fr;
    grid-template-rows: 1fr;

    background-color: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(10px);
    padding: 5px;
}

.guess-results-modal__content {
    grid-row: 1;
    grid-column: 1;

    display: grid;
    grid-template-columns: 12rem 1fr 12rem;
    grid-template-rows: 4.5rem 1fr 4.5rem 1fr;
}

.guess-results-modal__content--main {
    grid-row: 2/-1;
    grid-column: 2;
    display: flex;
    gap: 10px;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    
    color: white;
}

.guess-results-modal__content--map {
    height: 40vh;
    aspect-ratio: 16/9;
}

.guess-results-modal__content--main h1 {
    font-size: 3rem;
}

.guess-results-modal__content--main h2 {
    font-size: 2rem;
}

.guess-results-modal__content--main p {
    font-size: 1.5rem;
}

.guess-results-modal__correct {
    color: lime;
}

.guess-results-modal__incorrect {
    color: red;
}

.guess-results-modal__game-control {
  background-color: rgba(255, 255, 255, 0.95);
  border-radius: 25px;
  padding: 10px 40px;
  margin: 10px;

  font-weight: bold;
  font-size: 1.25rem;
  text-align: center;
}

.guess-results-modal__timer {
  grid-row: 1;
  grid-column: 1;
}

.guess-results-modal__stage {
  grid-row: 1;
  grid-column: 3;
}

.guess-results-modal__next {
  background-color: rgba(255, 255, 255, 0.95);
  font-size: 1rem;
  font-weight: bold;
  clip-path: polygon(0 0, 75% 0, 100% 50%, 75% 100%, 0 100%);
  padding-right: 15%;
  margin: 10px;
  grid-row: 3;
  grid-column: 3;
}
</style>